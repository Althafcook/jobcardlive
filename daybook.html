<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daybook</title>

<style>
body{margin:0;font-family:"Segoe UI",Arial,sans-serif;background:#111;color:#fff}
.header{padding:8px 12px;background:#000;display:grid;grid-template-columns:auto 1fr auto auto;align-items:center;border-bottom:1px solid #333;gap:10px}
.header h1{margin:0;font-size:18px}
.summary{display:flex;gap:6px;justify-content:center;font-size:12px}
.summary span{padding:3px 8px;border-radius:4px;font-weight:600;cursor:pointer}
.sum-arun{background:#d94a4a}
.sum-siyad{background:#8bc34a;color:#000}
.sum-sajid{background:#f2d23c;color:#000}
.sum-ashraf{background:#eee;color:#000}
.sum-total{background:#333}
.table-wrapper{height:calc(100vh - 56px);overflow:auto}
table{width:100%;min-width:980px;border-collapse:collapse}
thead th{position:sticky;top:0;background:#000;color:red;font-size:13px;padding:8px}
tbody td{font-size:13px;padding:4px 6px;text-align:center}
tbody tr:hover{background:#1b1b1b}
.loader{position:fixed;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:999}
.hidden{display:none}
</style>
</head>

<body>

<div class="header">
  <h1>Daybook</h1>
  <div class="summary" id="summary"></div>
</div>

<div class="table-wrapper">
<table>
<thead>
<tr>
  <th>No</th><th>Date</th><th>Time</th><th>Jobcard</th>
  <th>AIC</th><th>Customer</th><th>Executive</th>
  <th>Vehicle</th><th>Chassis</th>
</tr>
</thead>
<tbody id="body"></tbody>
</table>
</div>

<div class="loader hidden" id="loader">Loadingâ€¦</div>

<script>
const API="https://script.google.com/macros/s/AKfycbw4dVdfgm3NkISHwE_v8CNSrMbOtx75SZI4DPs1dM2b6qm1gchMSRPL41JkN-Vn5RAwrg/exec";
let loaded=false;

function show(){ if(!loaded) loader.classList.remove("hidden"); }
function hide(){ loader.classList.add("hidden"); loaded=true; }

function render(rows){
  body.innerHTML="";
  rows.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.style.cursor="pointer";
    tr.onclick=()=>{
      sessionStorage.setItem("JOB_CARD_DATA",JSON.stringify(r));
      sessionStorage.removeItem("JOB_CARD_PAYLOAD");
      location.href=`jobcard.html?chassis=${encodeURIComponent(r.chassis)}`;
    };
    tr.innerHTML=`
      <td>${i+1}</td><td>${r.date}</td><td>${r.time}</td>
      <td>${r.jobcard}</td><td>${r.aic}</td>
      <td>${r.customer}</td><td>${r.executive||""}</td>
      <td>${r.vehicle}</td><td>${r.chassis}</td>`;
    body.appendChild(tr);
  });
}

async function load(){
  show();
  const r=await fetch(API,{cache:"no-store"});
  const d=await r.json();
  render(d.rows||[]);
  hide();
}

load();
setInterval(load,30000); // silent refresh
</script>
</body>
</html>
