<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daybook</title>

<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

<style>
body{
  margin:0;
  font-family:"Segoe UI",Arial,sans-serif;
  background:#111;
  color:#fff;
}

/* HEADER */
.header{
  padding:8px 12px;
  background:#000;
  display:grid;
  grid-template-columns:auto 1fr auto auto;
  align-items:center;
  border-bottom:1px solid #333;
  gap:10px;
}
.header h1{
  margin:0;
  font-size:18px;
  font-weight:600;
}
.home-btn{cursor:pointer;font-size:18px}
.date{font-size:13px;color:#aaa}

/* SUMMARY */
.summary{
  display:flex;
  gap:6px;
  justify-content:center;
  font-size:12px;
  overflow-x:auto;
}
.summary span{
  padding:3px 8px;
  border-radius:4px;
  font-weight:600;
  cursor:pointer;
  white-space:nowrap;
}
.sum-arun{background:#d94a4a}
.sum-siyad{background:#8bc34a;color:#000}
.sum-sajid{background:#f2d23c;color:#000}
.sum-ashraf{background:#eee;color:#000}
.sum-total{background:#333}

/* TABLE */
.table-wrapper{height:calc(100vh - 56px);overflow:auto}
table{width:100%;border-collapse:collapse}
thead th{
  position:sticky;top:0;background:#000;color:red;
  font-size:13px;padding:8px;border-bottom:1px solid #444
}
tbody td{
  font-size:13px;padding:4px 6px;height:24px;
  border-bottom:1px solid #222;text-align:center
}
tbody tr:hover{background:#1b1b1b}

/* AIC COLORS */
.aic-arun{background:#d94a4a}
.aic-siyad{background:#8bc34a;color:#000}
.aic-sajid{background:#f2d23c;color:#000}
.aic-ashraf{background:#eee;color:#000}

/* EMPTY */
.empty-state{display:none;height:100vh;align-items:center;justify-content:center}

/* LOADER */
.loader{
  position:fixed;inset:0;background:#000c;
  display:flex;align-items:center;justify-content:center;z-index:999
}
.hidden{display:none}
</style>
</head>

<body>

<div class="header">
  <h1>Daybook</h1>
  <div class="summary" id="summary"></div>
  <div class="home-btn" onclick="location.href='index.html'">üè†</div>
  <div class="date" id="currentDate"></div>
</div>

<div class="empty-state" id="emptyState">
  <lottie-player
    src="https://assets7.lottiefiles.com/packages/lf20_xlmz9xwm.json"
    style="width:160px;height:160px"
    loop autoplay>
  </lottie-player>
</div>

<div class="table-wrapper" id="tableWrapper">
<table>
<thead>
<tr>
<th>No</th>
<th>Date</th>
<th>Time</th>
<th>Jobcard</th>
<th>AIC</th>
<th>Customer</th>
<th>Vehicle</th>
<th>Chassis</th>
</tr>
</thead>
<tbody id="daybookBody"></tbody>
</table>
</div>

<div class="loader hidden" id="loader">Loading‚Ä¶</div>

<script>
const DATA_URL =
"https://script.google.com/macros/s/AKfycbw4dVdfgm3NkISHwE_v8CNSrMbOtx75SZI4DPs1dM2b6qm1gchMSRPL41JkN-Vn5RAwrg/exec";

let allRows=[], currentFilter="TOTAL";

document.getElementById("currentDate").innerText =
  new Date().toLocaleDateString("en-GB");

/* AIC CLASS */
const aicClass=n=>({
  Arun:"aic-arun",Siyad:"aic-siyad",
  Sajid:"aic-sajid",Ashraf:"aic-ashraf"
}[n]||"");

/* SUMMARY */
function renderSummary(rows){
  const c={Arun:0,Siyad:0,Sajid:0,Ashraf:0};
  rows.forEach(r=>c[r.aic]++);
  document.getElementById("summary").innerHTML=`
    <span class="sum-arun" onclick="setFilter('Arun')">Arun ${c.Arun}</span>
    <span class="sum-siyad" onclick="setFilter('Siyad')">Siyad ${c.Siyad}</span>
    <span class="sum-sajid" onclick="setFilter('Sajid')">Sajid ${c.Sajid}</span>
    <span class="sum-ashraf" onclick="setFilter('Ashraf')">Ashraf ${c.Ashraf}</span>
    <span class="sum-total" onclick="setFilter('TOTAL')">Total ${rows.length}</span>`;
}

function setFilter(f){
  currentFilter=f;
  renderTable();
}

/* TABLE */
function renderTable(){
  const tbody=document.getElementById("daybookBody");
  tbody.innerHTML="";

  const rows=currentFilter==="TOTAL"
    ? allRows
    : allRows.filter(r=>r.aic===currentFilter);

  rows.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.onclick=()=>jobcardClick(r);
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${r.date}</td>
      <td>${r.time}</td>
      <td><b>${r.jobcard}</b></td>
      <td class="${aicClass(r.aic)}">${r.aic}</td>
      <td>${r.customer}</td>
      <td>${r.vehicle}</td>
      <td>${r.chassis}</td>`;
    tbody.appendChild(tr);
  });
}

/* CLICK ‚Üí JOB CARD */
function jobcardClick(row){
  const params = new URLSearchParams({
    jobcard: row.jobcard,
    chassis: row.chassis,
    color: row.color || ""
  });
  location.href = "jobcard.html?" + params.toString();
}

/* LOAD */
async function loadDaybook(){
  document.getElementById("loader").classList.remove("hidden");
  const r=await fetch(DATA_URL,{cache:"no-store"});
  const d=await r.json();
  allRows=d.rows||[];
  renderSummary(allRows);
  renderTable();
  document.getElementById("loader").classList.add("hidden");
}

loadDaybook();
setInterval(loadDaybook,30000);
</script>

</body>
</html>
