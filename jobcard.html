<script>
const API =
"https://script.google.com/macros/s/AKfycXXXX/exec"; // same working URL

const qs = new URLSearchParams(location.search);
const chassis = qs.get("chassis");

async function loadJobcard(){
  const r = await fetch(`${API}?mode=page`);
  const d = await r.json();

  // ✅ correct filter (API field name = chassis)
  const rows = d.rows.filter(
    r => String(r.chassis).trim() === String(chassis).trim()
  );

  if(!rows.length){
    console.log("No matching chassis:", chassis);
    return;
  }

  const h = rows[0];

  // ✅ header fill
  document.getElementById("cust").innerText = h.customer || "";
  document.getElementById("vehicle").innerText = h.vehicle || "";
  document.getElementById("exec").innerText = h.aic || "";
  document.getElementById("color").innerText = ""; // not in API
  document.getElementById("chassis").innerText = h.chassis || "";
  document.getElementById("jcDate").innerText =
    new Date().toLocaleDateString("en-GB");

  // ✅ items (jobcard level – placeholder for now)
  const tbody = document.getElementById("items");
  tbody.innerHTML = `
    <tr>
      <td>1</td>
      <td>Jobcard ${h.jobcard}</td>
      <td>IN</td>
      <td></td>
    </tr>`;
}

loadJobcard();
</script>
