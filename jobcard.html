<script>
const API =
"https://script.google.com/macros/s/AKfyc.../exec"; // SAME deployed URL

const qs = new URLSearchParams(location.search);
const chassis = qs.get("chassis");

async function loadJobcard(){
  if(!chassis) return;

  const r = await fetch(`${API}?mode=page`);
  const d = await r.json();

  const rows = d.rows.filter(r =>
    String(r.chasis_no).trim() === String(chassis).trim()
  );

  if(!rows.length) return;

  const h = rows[0];

  document.getElementById("cust").innerText = h.customer_name || "";
  document.getElementById("vehicle").innerText = h.vehicle || "";
  document.getElementById("color").innerText = h.color || "";
  document.getElementById("exec").innerText = h.executive || "";
  document.getElementById("chassis").innerText = chassis;
  document.getElementById("jcDate").innerText =
    new Date().toLocaleDateString("en-GB");

  const tbody = document.getElementById("items");
  tbody.innerHTML = "";

  rows.forEach((r,i)=>{
    tbody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${r.item_partnumber || ""}</td>
        <td>${r.given_status || ""}</td>
        <td></td>
      </tr>`;
  });
}

loadJobcard();
</script>
