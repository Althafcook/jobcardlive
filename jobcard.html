<script>
const API =
"https://script.google.com/macros/s/AKfycbw4dVdfgm3NkISHwE_v8CNSrMbOtx75SZI4DPs1dM2b6qm1gchMSRPL41JkN-Vn5RAwrg/exec";

const qs = new URLSearchParams(window.location.search);
const chassisParam = (qs.get("chassis") || "").trim();

async function loadJobcard(){
  try{
    const res = await fetch(API + "?mode=page", { cache:"no-store" });
    const data = await res.json();

    console.log("API RAW:", data);

    if(!data.rows || !data.rows.length){
      console.error("No rows from API");
      return;
    }

    // ðŸ” normalize chassis field
    const match = data.rows.find(r => {
      const ch =
        r.chassis ??
        r.Chassis ??
        r["Chassis No"] ??
        r.chassis_no ??
        "";
      return String(ch).trim() === chassisParam;
    });

    if(!match){
      console.error("No matching chassis:", chassisParam);
      return;
    }

    console.log("MATCH:", match);

    // ðŸ”¹ Fill header
    document.getElementById("cust").textContent =
      match.customer || match.Customer || "";

    document.getElementById("vehicle").textContent =
      match.vehicle || match.Vehicle || "";

    document.getElementById("exec").textContent =
      match.aic || match.AIC || "";

    document.getElementById("color").textContent =
      match.color || "";

    document.getElementById("chassis").textContent =
      match.chassis || match.Chassis || "";

    document.getElementById("jcDate").textContent =
      match.date || new Date().toLocaleDateString("en-GB");

    // ðŸ”¹ Items (temporary â€“ page sheet later)
    const tbody = document.getElementById("items");
    tbody.innerHTML = "";

    tbody.insertAdjacentHTML("beforeend", `
      <tr>
        <td>1</td>
        <td>Jobcard ${match.jobcard || match.Jobcard || ""}</td>
        <td>IN</td>
        <td></td>
      </tr>
    `);

  }catch(err){
    console.error("Jobcard load failed", err);
  }
}

loadJobcard();
</script>
