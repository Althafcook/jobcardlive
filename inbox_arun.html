<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox Arun</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  background:#000;
  font-family:Segoe UI,Arial;
  padding:14px;
  color:#cfcfcf;
}

/* HEADER */
.header{
  display:flex;
  align-items:center;
  gap:10px;
}

.badge{
  background:red;
  padding:6px 14px;
  border-radius:20px;
  font-size:13px;
  color:#fff;
}

h3{
  margin:0;
  font-weight:500;
}

/* CAT */
#catAnim{
  width:130px;
  height:130px;
  margin:15px auto 5px auto;
}

/* TABLE */
.table-wrap{
  overflow-x:auto;
}

table{
  width:100%;
  min-width:900px;
  border-collapse:collapse;
}

th,td{
  padding:10px;
  border-bottom:1px solid #222;
  font-size:13px;
  white-space:nowrap;
}

th{
  background:#111;
  color:#fff;
  position:sticky;
  top:0;
}

/* AGE RED */
.red-age{
  background:#8b0000;
  color:#fff;
}

/* AIC ARUN */
.aic-arun{
  background:#ff2e88;
  color:#fff;
  text-align:center;
}

/* ROW */
tbody tr{
  cursor:pointer;
  transition:0.2s;
}
tbody tr:hover{
  background:#111;
}

/* LOADER */
#loader{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.loader-percent{
  font-size:22px;
  color:#ff2e88;
  margin-top:15px;
}

.loader-sub{
  font-size:13px;
  margin-top:5px;
  letter-spacing:1px;
}
</style>
</head>

<body>

<!-- LOADER -->
<div id="loader">
  <div style="font-size:26px;color:#fff;">Loading</div>
  <div class="loader-percent" id="percentText">0%</div>
  <div class="loader-sub">Please wait...</div>
</div>

<!-- HEADER -->
<div class="header">
  <div class="badge" id="inboxCount">0</div>
  <h3>Inbox - Arun (Work not done)</h3>
</div>

<!-- CAT BELOW HEADING -->
<div id="catAnim"></div>

<div class="table-wrap">
<table id="dataTable">
  <thead>
    <tr>
      <th>No.</th>
      <th>Date</th>
      <th>Age</th>
      <th>AIC</th>
      <th>Customer</th>
      <th>Vehicle</th>
      <th>Executive</th>
      <th>Chase</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script>

const DATA_API =
"https://script.google.com/macros/s/AKfycbxbKFzPH4mlW6_6SGMqppmgPy0D6FXBRfY6AddknP837mnJkLy_u5noIGCaoZ_X2aV_aA/exec?mode=inbox_arun";

const COUNT_API =
"https://script.google.com/macros/s/AKfycbxbKFzPH4mlW6_6SGMqppmgPy0D6FXBRfY6AddknP837mnJkLy_u5noIGCaoZ_X2aV_aA/exec";

/* ðŸ”¥ USE SAME API AS DAYBOOK */
const JOBCARD_API =
"https://script.google.com/macros/s/AKfycbwr0Ltlv2tRUZWt8CnDtH7Zx3qcG3CzIEuMBncow_FS0SW3f7pyEaTziYnGtNvcOSYZ-w/exec";

/* CAT ANIMATION */
lottie.loadAnimation({
  container: document.getElementById('catAnim'),
  renderer: 'svg',
  loop: true,
  autoplay: true,
  path: 'assets/images/cat.json'
});

/* LOADER PERCENT */
function animateLoader(){
  let percent = 0;
  const el = document.getElementById("percentText");

  const interval = setInterval(()=>{
    percent += 3;
    if(percent > 90) percent = 90;
    el.textContent = percent + "%";
  },60);

  return interval;
}

/* LOAD COUNT */
function loadCount(){
  fetch(COUNT_API,{cache:"no-store"})
  .then(r=>r.json())
  .then(d=>{
    if(d.inbox !== undefined){
      document.getElementById("inboxCount").textContent = d.inbox;
    }
  });
}

/* LOAD DATA */
function loadData(){
  const loaderInterval = animateLoader();

  fetch(DATA_API,{cache:"no-store"})
  .then(r=>r.json())
  .then(data=>{
    const tbody=document.querySelector("#dataTable tbody");
    tbody.innerHTML="";

    if(!Array.isArray(data)){
      document.getElementById("loader").style.display="none";
      return;
    }

    let displayIndex=1;

    data.forEach((row)=>{
      if(row.every(cell=>cell==="" || cell===null)) return;

      const tr=document.createElement("tr");

      const chaseNumber = row[6];

      /* ðŸ”¥ EXACT SAME LOGIC AS DAYBOOK */
      tr.onclick = ()=>{
        fetch(
          JOBCARD_API + "?mode=setChase&chase=" + encodeURIComponent(chaseNumber),
          { mode:"no-cors" }
        );
        location.href="jobcard_arun.html";
      };

      const noTd=document.createElement("td");
      noTd.textContent = displayIndex++;
      tr.appendChild(noTd);

      row.forEach((cell,index)=>{
        const td=document.createElement("td");
        td.textContent=cell;

        if(index===1){
          const age=parseInt(cell);
          if(!isNaN(age) && age>60){
            td.classList.add("red-age");
          }
        }

        if(index===2 && cell==="Arun"){
          td.classList.add("aic-arun");
        }

        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });

    clearInterval(loaderInterval);
    document.getElementById("percentText").textContent="100%";

    setTimeout(()=>{
      document.getElementById("loader").style.display="none";
    },300);

  })
  .catch(()=>{
    document.getElementById("loader").style.display="none";
  });
}

/* INITIAL LOAD */
loadCount();
loadData();

/* SILENT REFRESH */
setInterval(()=>{
  loadCount();
  loadData();
},30000);

</script>

</body>
</html>
