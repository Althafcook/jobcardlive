<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox Arun</title>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Segoe UI,Arial;
  padding:10px;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.badge{
  background:red;
  padding:4px 10px;
  border-radius:20px;
  font-size:13px;
  font-weight:bold;
}

.table-wrap{
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}

table{
  width:100%;
  min-width:800px;
  border-collapse:collapse;
}

th,td{
  padding:8px;
  border-bottom:1px solid #222;
  font-size:13px;
  white-space:nowrap;
}

th{
  background:#111;
  text-align:left;
  position:sticky;
  top:0;
}

.red-age{
  background:#8b0000;
  color:#fff;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
  <h3>Inbox - Arun</h3>
  <div class="badge" id="inboxCount">0</div>
</div>

<div class="table-wrap">
<table id="dataTable">
  <thead>
    <tr>
      <th>No.</th>
      <th>Date</th>
      <th>Age</th>
      <th>AIC</th>
      <th>Customer</th>
      <th>Vehicle</th>
      <th>Executive</th>
      <th>Chase</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script>

const DATA_API =
"https://script.google.com/macros/s/AKfycbxbKFzPH4mlW6_6SGMqppmgPy0D6FXBRfY6AddknP837mnJkLy_u5noIGCaoZ_X2aV_aA/exec?mode=inbox_arun";

const COUNT_API =
"https://script.google.com/macros/s/AKfycbxbKFzPH4mlW6_6SGMqppmgPy0D6FXBRfY6AddknP837mnJkLy_u5noIGCaoZ_X2aV_aA/exec";

function loadCount(){
  fetch(COUNT_API,{cache:"no-store"})
  .then(r=>r.json())
  .then(d=>{
    if(d.inbox !== undefined){
      document.getElementById("inboxCount").textContent = d.inbox;
    }
  });
}

function loadData(){
  fetch(DATA_API,{cache:"no-store"})
  .then(r=>r.json())
  .then(data=>{
    const tbody=document.querySelector("#dataTable tbody");
    tbody.innerHTML="";

    if(!Array.isArray(data)) return;

    data.forEach((row,rowIndex)=>{
      const tr=document.createElement("tr");

      // ðŸ”¹ NO COLUMN
      const noTd=document.createElement("td");
      noTd.textContent = rowIndex + 1;
      tr.appendChild(noTd);

      row.forEach((cell,index)=>{
        const td=document.createElement("td");
        td.textContent=cell;

        // Age column (index 1)
        if(index===1){
          const age=parseInt(cell);
          if(!isNaN(age) && age>60){
            td.classList.add("red-age");
          }
        }

        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });
  });
}

function refreshAll(){
  loadData();
  loadCount();
}

// First load
refreshAll();

// Silent refresh every 30 sec
setInterval(refreshAll,30000);

</script>

</body>
</html>
