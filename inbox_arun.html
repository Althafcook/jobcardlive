<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox Arun</title>

<!-- LOTTIE -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  background:#000;
  font-family:Segoe UI,Arial;
  padding:10px;
  color:#cfcfcf; /* premium lite grey */
}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.title-wrap{
  display:flex;
  align-items:center;
  gap:10px;
}

.badge{
  background:red;
  padding:4px 10px;
  border-radius:20px;
  font-size:13px;
  font-weight:bold;
  color:#fff;
}

/* LOTTIE CAT */
#catAnim{
  width:40px;
  height:40px;
}

/* TABLE */
.table-wrap{
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}

table{
  width:100%;
  min-width:850px;
  border-collapse:collapse;
}

th,td{
  padding:9px;
  border-bottom:1px solid #222;
  font-size:13px;
  white-space:nowrap;
}

th{
  background:#111;
  text-align:left;
  position:sticky;
  top:0;
  color:#fff;
}

/* AGE RED */
.red-age{
  background:#8b0000;
  color:#fff;
  font-weight:bold;
}

/* AIC ARUN PINK */
.aic-arun{
  background:#ff2e88;
  color:#fff;
  font-weight:bold;
}

/* LOADING SCREEN */
#loader{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:999;
  color:#fff;
}

.loader-bar{
  width:200px;
  height:6px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  margin-top:15px;
}

.loader-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ff2e88,#ff0055);
  transition:width 0.3s ease;
}

.loader-text{
  margin-top:10px;
  font-size:14px;
  letter-spacing:1px;
}
</style>
</head>

<body>

<!-- LOADER -->
<div id="loader">
  <div style="font-size:22px;font-weight:bold;">Loading</div>
  <div class="loader-bar">
    <div class="loader-fill" id="loaderFill"></div>
  </div>
  <div class="loader-text" id="loaderText">0% Please wait...</div>
</div>

<div class="header">
  <div class="title-wrap">
    <div id="catAnim"></div>
    <h3>Inbox - Arun</h3>
  </div>
  <div class="badge" id="inboxCount">0</div>
</div>

<div class="table-wrap">
<table id="dataTable">
  <thead>
    <tr>
      <th>No.</th>
      <th>Date</th>
      <th>Age</th>
      <th>AIC</th>
      <th>Customer</th>
      <th>Vehicle</th>
      <th>Executive</th>
      <th>Chase</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script>

const DATA_API =
"https://script.google.com/macros/s/AKfycbxbKFzPH4mlW6_6SGMqppmgPy0D6FXBRfY6AddknP837mnJkLy_u5noIGCaoZ_X2aV_aA/exec?mode=inbox_arun";

const COUNT_API =
"https://script.google.com/macros/s/AKfycbxbKFzPH4mlW6_6SGMqppmgPy0D6FXBRfY6AddknP837mnJkLy_u5noIGCaoZ_X2aV_aA/exec";

/* LOAD CAT ANIMATION */
lottie.loadAnimation({
  container: document.getElementById('catAnim'),
  renderer: 'svg',
  loop: true,
  autoplay: true,
  path: 'assets/images/cat.json'
});

/* LOADER ANIMATION */
function fakeLoader(){
  let percent=0;
  const fill=document.getElementById("loaderFill");
  const text=document.getElementById("loaderText");

  const interval=setInterval(()=>{
    percent+=5;
    fill.style.width=percent+"%";
    text.textContent=percent+"% Please wait...";

    if(percent>=100){
      clearInterval(interval);
      setTimeout(()=>{
        document.getElementById("loader").style.display="none";
      },300);
    }
  },40);
}

/* LOAD COUNT */
function loadCount(){
  fetch(COUNT_API,{cache:"no-store"})
  .then(r=>r.json())
  .then(d=>{
    if(d.inbox !== undefined){
      document.getElementById("inboxCount").textContent = d.inbox;
    }
  });
}

/* LOAD DATA */
function loadData(){
  fetch(DATA_API,{cache:"no-store"})
  .then(r=>r.json())
  .then(data=>{
    const tbody=document.querySelector("#dataTable tbody");
    tbody.innerHTML="";

    if(!Array.isArray(data)) return;

    let displayIndex=1;

    data.forEach((row)=>{
      // Skip fully blank rows
      if(row.every(cell=>cell==="" || cell===null)) return;

      const tr=document.createElement("tr");

      // NO COLUMN
      const noTd=document.createElement("td");
      noTd.textContent = displayIndex++;
      tr.appendChild(noTd);

      row.forEach((cell,index)=>{
        const td=document.createElement("td");
        td.textContent=cell;

        // AGE COLUMN
        if(index===1){
          const age=parseInt(cell);
          if(!isNaN(age) && age>60){
            td.classList.add("red-age");
          }
        }

        // AIC COLUMN
        if(index===2 && cell==="Arun"){
          td.classList.add("aic-arun");
        }

        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });
  });
}

function refreshAll(){
  loadData();
  loadCount();
}

/* INITIAL LOAD */
fakeLoader();
refreshAll();

/* SILENT AUTO REFRESH */
setInterval(refreshAll,30000);

</script>

</body>
</html>
