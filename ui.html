<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {font-family: Arial; padding: 15px;}
    select, textarea, button {width:100%; margin-top:10px;}
    img {width:100%; margin-top:10px;}
  </style>
</head>

<body>

<h3>WhatsApp Sender</h3>

<select id="contact"></select>

<textarea id="msg" rows="5"></textarea>

<img id="preview"/>

<button onclick="send()">Open WhatsApp</button>

<script>

let data=[];

google.script.run.withSuccessHandler(d=>{
  data=d;
  let sel=document.getElementById("contact");

  d.forEach((r,i)=>{
    sel.add(new Option(r[0],i));
  });

  load();
}).getData();

document.getElementById("contact").onchange=load;

function load(){
  let i=document.getElementById("contact").value;
  let r=data[i];

  document.getElementById("msg").value=r[1];
  document.getElementById("preview").src=r[2];
}

function send(){
  let i=document.getElementById("contact").value;
  let r=data[i];

  let url="https://wa.me/"+r[0]+"?text="+encodeURIComponent(document.getElementById("msg").value);

  window.open(url,"_blank");

  alert("WhatsApp opened.\nAttach image & send.");
}

</script>

</body>
</html>
